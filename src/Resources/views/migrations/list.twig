{% extends '@ibexadesign/ui/layout.html.twig' %}

{% block title %}{{ 'Migrations'|trans }}{% endblock %}

{%- block breadcrumbs -%}
    {% include '@ibexadesign/ui/breadcrumbs.html.twig' with { items: [
        { value: 'breadcrumb.admin'|trans(domain='messages')|desc('Admin') },
        { value: 'url.list'|trans|desc('Migrations') }
    ]} %}
{%- endblock -%}

{%- block header -%}
    {% include '@ibexadesign/ui/page_title.html.twig' with {
        title: 'url.list'|trans|desc('Migrations'),
    } %}
{%- endblock -%}

{%- block content -%}
    <section class="container ibexa-container">
        {% set body_rows = [] %}
        {% for migrationData in migrations.currentPageResults %}
            {% set migration = migrationData.migration %}
            {% set isExecuted = migrationData.isExecuted %}
            
            {% set status_badge %}
                {% if isExecuted %}
                    <span class="ibexa-badge ibexa-badge--success">{{ 'Executed'|trans }}</span>
                {% else %}
                    <span class="ibexa-badge ibexa-badge--warning">{{ 'Pending'|trans }}</span>
                {% endif %}
            {% endset %}

            {% set body_rows = body_rows|merge([{
                cols: [
                    { content: migration.name },
                    { content: status_badge, raw: true },
                    { content: migrationData.createdAt ? migrationData.createdAt|date('Y-m-d H:i:s') : '-' },
                    { content: migrationData.executedAt ? migrationData.executedAt|date('Y-m-d H:i:s') : '-' }
                ],
            }]) %}
        {% endfor %}

        {% set name_header %}
            {% include '@IbexaAutomaticMigrationsBundle/partials/sortable_header.html.twig' with { label: 'Migration Name'|trans, field: 'name', current_sort: sort, direction: direction } %}
        {% endset %}
        {% set status_header %}
            {% include '@IbexaAutomaticMigrationsBundle/partials/sortable_header.html.twig' with { label: 'Status'|trans, field: 'status', current_sort: sort, direction: direction } %}
        {% endset %}
        {% set created_header %}
            {% include '@IbexaAutomaticMigrationsBundle/partials/sortable_header.html.twig' with { label: 'Created at'|trans, field: 'createdAt', current_sort: sort, direction: direction } %}
        {% endset %}
        {% set executed_header %}
            {% include '@IbexaAutomaticMigrationsBundle/partials/sortable_header.html.twig' with { label: 'Executed at'|trans, field: 'executedAt', current_sort: sort, direction: direction } %}
        {% endset %}

        {% include '@ibexadesign/ui/component/table/table.html.twig' with {
            headline: 'Migrations'|trans,
            head_cols: [
                { content: name_header, raw: true },
                { content: status_header, raw: true },
                { content: created_header, raw: true },
                { content: executed_header, raw: true },
            ],
            class: 'ibexa-table',
            body_rows
        } %}

        {% if migrations.haveToPaginate %}
            {% include '@ibexadesign/ui/pagination.html.twig' with {
                'pager': migrations
            } %}
        {% endif %}
    </section>
{%- endblock -%}

{% block javascripts %}
    {{ encore_entry_script_tags('ibexa-admin-ui-dashboard-js', null, 'ibexa') }}
{%- endblock -%}